<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <base href="/">
    <title>Instant Multi-Page App</title>

    <link rel="icon" href="favicon.ico" type="image/x-icon"/>
    <link rel='shortcut icon' type='image/x-icon' href='favicon.ico'>
    <link rel="stylesheet" href="src/css/styles.css">
  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/readablestream">Readable Stream</a></li>
          <li><a href="/serviceworker">Service Worker</a></li>
          <li><a href="/contact">Contact</a></li>
          <li><a href="/images">Images</a></li>
          <li><a href="/blog">Blog</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <section id="content">
        <h2>An instant multi-page app</h2>

        <p>
          This is a demo of a instantly loading multi-page app, using modern web technology like Service Worker,
          ReadableStream,
          CSS Containment and Portals.
        </p>

        <p>
          The purpose is to demonstrate that a multi-page app can load just as fast as a single-page app, without all
          the
          added complexity that a single-page app brings.
        </p>

        <p>
          Each request is intercepted by the Service Worker which then constructs each page from a header, footer and
          the
          page content. These parts are all separate HTML templates that are fetched separately and then put together to
          form
          a page.
        </p>

        <p>
          To make sure that content is shown to the user as soon as possible, a ReadableStream is used to stream content
          to
          the browser. This means that the browser doesn't need to wait for the whole response to arrive, but can start
          rendering content as soon as it becomes available.
        </p>

        <p>
          The Service Worker also caches all assets locally so these no longer need to be fetched from the network.
        </p>

        <p>
          The result is that each page loads instantly, just like a single-page app, even though the browser performs a
          full
          page reload for each page.
        </p>

        <p>
          This effectively reduces single-page apps to a polyfill.
        </p>
      </section>
    </main>

    <footer></footer>

    <script>
      console.log('home');

      // const url = 'https://3jrnxopv87.execute-api.us-east-1.amazonaws.com/production/blogpostings/writer/danny';
      //
      // fetch(url)
      // .then(response => response.json())
      // .then(json => {
      //   console.log(json);
      // });

      if(!document.querySelector('#preview-portal')) {
        document.body.insertAdjacentHTML('beforeend', `<portal id="preview-portal"></portal>`);
      }
      const portal = document.querySelector('#preview-portal');
      const {width: portalWidth} = portal.getBoundingClientRect();

      const showPreview = e => {
        const li = e.composedPath().find(el => el.tagName && el.tagName.toLowerCase() === 'li');

        if(li) {
          const link = li.querySelector('a');

          if(link) {
            portal.style.left = `${li.dataset.x}px`;
            portal.style.top = `${li.dataset.y}px`;
            portal.src = link.href;
            portal.classList.add('visible');
          }
        }
      };

      const removePreview = e => {
        const li = e.composedPath().find(el => el.tagName && el.tagName.toLowerCase() === 'li');

        if(li) {
          portal.classList.remove('visible');
        }
      };

      const nav = document.querySelector('nav');

      // nav.addEventListener('mouseover', showPreview);
      // nav.addEventListener('mouseout', removePreview);

      nav.querySelectorAll('li').forEach(li => {
        const {width, height, top, left} = li.getBoundingClientRect();

        li.dataset.x = (left + width / 2) - portalWidth / 2;
        li.dataset.y = top + height;
      });

    </script>

  </body>
</html>
